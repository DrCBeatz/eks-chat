<?xml version="1.0" encoding="UTF-8"?>
<svg width="1100" height="720" viewBox="0 0 1100 720" xmlns="http://www.w3.org/2000/svg">
  <style>
    .box{fill:#0b1220;stroke:#4b5563;stroke-width:1.2;rx:8;ry:8}
    .light{fill:#111827}
    .label{fill:#e5e7eb;font-family:system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, Cantarell, Arial;font-size:14px}
    .title{fill:#e5e7eb;font-weight:700;font-size:16px}
    .chip{fill:#1f2937;stroke:#374151;stroke-width:1;rx:6;ry:6}
    .chipText{fill:#93c5fd;font-size:12px;font-family:system-ui, -apple-system, 'Segoe UI', Roboto}
    .arrow{stroke:#94a3b8;stroke-width:1.6;marker-end:url(#arrow)}
    .note{fill:#94a3b8;font-size:12px;font-family:system-ui, -apple-system, 'Segoe UI', Roboto}
  </style>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#94a3b8"/>
    </marker>
  </defs>

  <!-- Browser / UI -->
  <rect x="30" y="30" width="470" height="310" class="box"/>
  <text x="45" y="55" class="title">Browser (S3 Static Web UI)</text>

  <!-- Chips -->
  <rect x="45" y="75" width="60" height="22" class="chip"/><text x="55" y="90" class="chipText">RAG</text>
  <rect x="115" y="75" width="68" height="22" class="chip"/><text x="125" y="90" class="chipText">STRICT</text>
  <rect x="193" y="75" width="64" height="22" class="chip"/><text x="203" y="90" class="chipText">KB</text>
  <rect x="267" y="75" width="86" height="22" class="chip"/><text x="277" y="90" class="chipText">API host</text>

  <text x="45" y="120" class="label">Toolbar: Temperature · RAG toggle · Strict toggle · “set API”</text>
  <text x="45" y="145" class="label">Banner: Demo only — not medical advice; no PHI</text>
  <text x="45" y="170" class="label">Samples: “List covered CGM codes”, “CGM renewal PA?”, “A1C/hypoglycemia”</text>

  <rect x="45" y="190" width="440" height="135" class="box light"/>
  <text x="60" y="215" class="label">SSE Frames</text>
  <text x="60" y="240" class="note">1) sources — shown early so UI can render citations</text>
  <text x="60" y="260" class="note">2) delta — token stream</text>
  <text x="60" y="280" class="note">3) done — completion + usage</text>

  <!-- ALB -->
  <rect x="530" y="70" width="160" height="80" class="box"/>
  <text x="540" y="100" class="title">AWS ALB</text>
  <text x="540" y="120" class="note">Public Load Balancer</text>

  <!-- Backend (EKS) -->
  <rect x="730" y="30" width="340" height="310" class="box"/>
  <text x="745" y="55" class="title">EKS Pod (FastAPI)</text>
  <text x="745" y="80" class="label">/chat, /chat/stream</text>
  <text x="745" y="100" class="label">/rag/status, /rag/reindex</text>

  <rect x="745" y="120" width="310" height="85" class="box light"/>
  <text x="760" y="145" class="label">Support Judge (JSON)</text>
  <text x="760" y="170" class="note">Decides if user Q is directly supported by retrieved context.</text>

  <rect x="745" y="215" width="310" height="105" class="box light"/>
  <text x="760" y="240" class="label">RAG Retriever + FAISS</text>
  <text x="760" y="260" class="note">Titan v2 embeddings; index persisted on PVC.</text>
  <text x="760" y="280" class="note">`/rag/reindex` pulls from S3.</text>

  <!-- Arrows UI -> ALB -> Backend -->
  <line x1="500" y1="135" x2="530" y2="110" class="arrow"/>
  <line x1="690" y1="110" x2="730" y2="110" class="arrow"/>

  <!-- SSE back -->
  <line x1="730" y1="140" x2="690" y2="140" class="arrow"/>
  <line x1="530" y1="140" x2="500" y2="210" class="arrow"/>

  <!-- Bedrock & Titan -->
  <rect x="730" y="370" width="340" height="140" class="box"/>
  <text x="745" y="395" class="title">Amazon Bedrock</text>
  <text x="745" y="420" class="label">Claude 3 Haiku (chat + judge)</text>
  <text x="745" y="440" class="label">Titan Embed Text v2 (embeddings)</text>

  <line x1="900" y1="340" x2="900" y2="370" class="arrow"/>
  <text x="910" y="360" class="note">model calls</text>

  <!-- S3 RAG bucket -->
  <rect x="30" y="370" width="300" height="140" class="box"/>
  <text x="45" y="395" class="title">S3 RAG Bucket</text>
  <text x="45" y="420" class="label">docs/ (policy Markdown / PDFs)</text>

  <line x1="330" y1="440" x2="730" y2="268" class="arrow"/>
  <text x="460" y="420" class="note">/rag/reindex</text>

  <!-- PVC -->
  <rect x="370" y="370" width="300" height="140" class="box"/>
  <text x="385" y="395" class="title">PVC: /app/store</text>
  <text x="385" y="420" class="label">FAISS index persisted</text>
  <line x1="670" y1="440" x2="900" y2="440" class="arrow"/>
  <text x="695" y="460" class="note">embeddings</text>

  <!-- UI -> /rag/status -->
  <line x1="500" y1="260" x2="730" y2="250" class="arrow"/>
  <text x="565" y="245" class="note">/rag/status</text>

  <!-- Notes -->
  <text x="30" y="540" class="note">Strict mode: if judge says unsupported → backend emits “Not in policy.” early.</text>
  <text x="30" y="560" class="note">Non‑strict: backend shows Sources only if judged as supported; otherwise hide citations.</text>
</svg>
